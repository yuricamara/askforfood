{"version":3,"sources":["../../src/pages/cart-step1/cart-step1.module.ts","../../src/pages/cart-step1/cart-step1.ts"],"names":[],"mappings":"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","file":"15.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { CartStep1Page } from './cart-step1';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    CartStep1Page,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(CartStep1Page),\r\n  ],\r\n})\r\nexport class CartStep1PageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cart-step1/cart-step1.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, LoadingController, NavController } from 'ionic-angular';\nimport { AngularFireAuth } from 'angularfire2/auth';\n\n\nimport { ICompany, IProductExisting } from '../../interfaces';\nimport { CartService, ProductService } from '../../services';\n\nimport { first, map } from 'rxjs/operators';\n\n@IonicPage({\n  segment: 'cart/step1'\n})\n@Component({\n  selector: 'page-cart-step1',\n  templateUrl: 'cart-step1.html',\n})\nexport class CartStep1Page {\n  loading: any;\n\n  companies: ICompany[] = [];\n  products: IProductExisting[] = [];\n\n  priceTotal: number;\n\n  constructor(\n    public angularFireAuth: AngularFireAuth,\n    private cartService: CartService,\n    public loadingCtrl: LoadingController,\n    public navCtrl: NavController,\n    private productService: ProductService\n  ) {}\n\n  ionViewDidLoad() {\n    this.loading = this.loadingCtrl.create({\n      content: 'Aguarde...',\n      dismissOnPageChange: true\n    });\n\n    this.loading.present();\n\n    this.getAllProductsFromCart();\n  }\n\n  private getAllProductsFromCart(){\n\n    this.cartService\n      .getAllSkus()\n      .pipe(first())\n      .pipe(map( skus => {\n        const productsSubscription = [];\n\n        skus.forEach( sku => {\n          const _subscription = this.productService.getOne(sku);\n          productsSubscription.push( _subscription);\n        });\n\n        return productsSubscription;\n      }))\n      .subscribe(productsSubscription => {\n        if(!productsSubscription){ return; }\n\n        const products = [];\n        let i: number = 0;\n        let priceTotal: number = 0;\n\n        productsSubscription.forEach(productSubscription => {\n          productSubscription\n            .pipe(first())\n            .subscribe(product => {\n              products.push(product);\n              priceTotal+= +product.price;\n\n              i++;\n\n              if(i === products.length){\n                this.priceTotal = priceTotal;\n                this.products = products;\n                this.loading.dismiss();\n              }\n            });\n        });\n      }, error => {\n        console.error(error);\n        this.loading.dismiss();\n      });\n  }\n\n  goToProductPage(productKey){\n    this.navCtrl.push('ProductPage', {\n      productKey\n    });\n  }\n\n  goToNextStepPage(){\n    this.angularFireAuth\n      .authState\n      .pipe(first())\n      .subscribe(user => {\n        if(!user){\n          this.navCtrl.push('EntrancePage',{\n            nextPage: 'CartStep2Page'\n          });\n          return;\n        }\n\n        this.navCtrl.push('CartStep2Page');\n\n      }, error => console.error(error));\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cart-step1/cart-step1.ts"],"sourceRoot":""}