{"version":3,"sources":["../../src/pages/user-profile/user-profile.module.ts","../../src/pages/user-profile/user-profile.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { UserProfilePage } from './user-profile';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    UserProfilePage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(UserProfilePage),\r\n  ],\r\n})\r\nexport class UserProfilePageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/user-profile/user-profile.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, LoadingController, NavController } from 'ionic-angular';\nimport { AngularFireAuth } from 'angularfire2/auth';\n\nimport { IPurchaseData, ProductService, PurchaseService } from '../../services';\n\nimport { IProductExisting } from '../../interfaces';\nimport { first } from 'rxjs/operators';\n\n@IonicPage({\n  segment: 'user-profile'\n})\n@Component({\n  selector: 'page-user-profile',\n  templateUrl: 'user-profile.html',\n})\nexport class UserProfilePage {\n  loading: any;\n\n  uid: string;\n  name: string;\n  productsList: any;\n  private products: IProductExisting[];\n  private purchasesData: IPurchaseData[];\n  private purchaseCounter: number;\n\n  constructor(\n    public angularFireAuth: AngularFireAuth,\n    private loadingCtrl: LoadingController,\n    public navCtrl: NavController,\n    private productService: ProductService,\n    private purchaseService: PurchaseService\n  ) {}\n\n  ionViewDidLoad(){\n    this.init();\n  }\n\n  private init(){\n    this.loading = this.loadingCtrl.create({\n      content: 'Aguarde...',\n      dismissOnPageChange: true\n    });\n\n    this.loading.present().then(() => {\n      this.angularFireAuth\n        .authState\n        .pipe(first())\n        .subscribe(user => {\n          if(!user){ return; }\n\n          this.uid = user.uid;\n          this.name = user.displayName;\n          this.getPurchases();\n        }, error => {\n          this.loading.dismiss();\n          console.error(error);\n        });\n    });\n  }\n\n  private getPurchases(){\n    this.purchaseService\n      .getProductsFromPurchases({\n        uid: this.uid\n      })\n      .pipe(first())\n      .subscribe( purchasesData => {\n        this.purchasesData = purchasesData;\n\n        if(!this.purchasesData.length){\n          this.productsList = [];\n          this.loading.dismiss();\n          return;\n        }\n\n        this.products = [];\n        this.purchaseCounter = 0;\n        this.purchasesData.forEach(purchaseData => {\n          this.getProduct(purchaseData);\n        });\n\n      }, error => {\n        this.loading.dismiss();\n        console.error(error);\n      });\n  }\n\n  private getProduct(purchaseData){\n    this.productService\n      .getOne(purchaseData.productKey)\n      .pipe(first())\n      .subscribe(p => {\n        this.products.push(p);\n        this.purchaseCounter++;\n\n        if(this.purchaseCounter === this.purchasesData.length){\n          this.createProductsList(this.products);\n        }\n      });\n  }\n\n  private createProductsList(products){\n    const productsList = this.purchasesData.map(purchase => {\n      const { productKey, timestamp } = purchase;\n      const product = products.find(p => p.key === productKey);\n\n      return {\n        product,\n        timestamp\n      };\n    });\n\n    this.productsList = productsList.sort((product1,product2) => {\n      return product2.timestamp - product1.timestamp;\n    });\n\n    this.loading.dismiss();\n  }\n\n  goToProductPage(productKey){\n    this.navCtrl.push('ProductPage', {\n      productKey\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/user-profile/user-profile.ts"],"sourceRoot":""}